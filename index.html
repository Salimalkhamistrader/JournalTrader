<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ú˜ÙˆØ±Ù†Ø§Ù„ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ XAUUSD - Ø§Ø±ØªÙ‚Ø§ ÛŒØ§ÙØªÙ‡</title>
    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); padding:20px; min-height:100vh }
        .container{ max-width:1400px; margin:0 auto; background:white; border-radius:15px; box-shadow:0 20px 60px rgba(0,0,0,0.3); overflow:hidden }
        .header{ background:linear-gradient(135deg,#2c3e50 0%,#34495e 100%); color:white; padding:30px; text-align:center }
        .header h1{ font-size:28px; margin-bottom:10px }
        .form-section{ padding:30px }
        .form-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:20px; margin-bottom:30px }
        .form-group{ display:flex; flex-direction:column }
        .form-group label{ font-weight:600; margin-bottom:8px; color:#2c3e50; font-size:14px }
        .form-group select, .form-group input, .form-group textarea{ padding:12px; border:2px solid #e0e0e0; border-radius:8px; font-size:14px; transition:all .3s; font-family:inherit }
        .button-group{ display:flex; gap:15px; justify-content:center; margin-top:20px; flex-wrap:wrap }
        button{ padding:12px 26px; border:none; border-radius:8px; font-size:14px; font-weight:600; cursor:pointer }
        .btn-save{ background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white }
        .btn-update{ background:#8e44ad; color:white }
        .btn-clear{ background:#95a5a6; color:white }
        .btn-excel{ background:#16a085; color:white }
        .btn-import{ background:#3498db; color:white }
        .btn-pdf{ background:#c0392b; color:white }
        .journal-table{ margin-top:20px; overflow-x:auto }
        table{ width:100%; border-collapse:collapse; font-size:13px }
        th, td{ padding:10px; text-align:right; border-bottom:1px solid #e0e0e0 }
        th{ background:#f8f9fa; font-weight:600; color:#2c3e50; position:sticky; top:0 }
        tr:hover{ background:#f8f9fa }
        .selected-row{ background:#e8f0fe !important; }
        .profit{ color:#27ae60; font-weight:600 }
        .loss{ color:#e74c3c; font-weight:600 }
        .stats{ display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; margin-bottom:20px; padding:20px; background:#f8f9fa; border-radius:10px }
        .stat-card{ background:white; padding:20px; border-radius:8px; text-align:center; box-shadow:0 2px 10px rgba(0,0,0,0.1) }
        .section-title{ font-size:20px; color:#2c3e50; margin-bottom:12px; padding-bottom:8px; border-bottom:3px solid #667eea }
        .filter-row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom:18px }
        .small{ padding:8px 12px; border-radius:6px; border:1px solid #ddd }
        .delete-btn{ background:#e74c3c; color:white; padding:6px 10px; border:none; border-radius:5px; cursor:pointer }
        .alert{ padding:12px; margin-bottom:12px; border-radius:8px; font-weight:600 }
        .alert-success{ background:#d4edda; color:#155724; border:1px solid #c3e6cb }
        .alert-error{ background:#f8d7da; color:#721c24; border:1px solid #f5c6cb }
        .alert-info{ background:#d1ecf1; color:#0c5460; border:1px solid #bee5eb }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š Ú˜ÙˆØ±Ù†Ø§Ù„ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ XAUUSD - ÙØ§ÛŒÙ„ ØªÚ©â€ŒÙØ§ÛŒÙ„ÛŒ (Ù‚Ø§Ø¨Ù„ Ø§Ø¬Ø±Ø§ Ø¯Ø± GitHub Pages)</h1>
            <p>Ù†Ø³Ø®Ù‡ Ø§Ø±ØªÙ‚Ø§ ÛŒØ§ÙØªÙ‡: ÙÛŒÙ„ØªØ± Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒØŒ Ú†Ù†Ø¯ ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… Ø±ÙˆÙ†Ø¯ØŒ Ø®Ø±ÙˆØ¬ÛŒ Excel Ùˆ PDF</p>
        </div>

        <div class="form-section">
            <div id="alertContainer"></div>
            <h2 class="section-title">Ø«Ø¨Øª Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¬Ø¯ÛŒØ¯</h2>
            <div class="form-grid">
                <div class="form-group"><label>ØªØ§Ø±ÛŒØ® Ùˆ Ø²Ù…Ø§Ù† <span class="required">*</span></label><input type="datetime-local" id="datetime" required></div>
                <div class="form-group"><label>Ù†ÙˆØ¹ Ù…Ø¹Ø§Ù…Ù„Ù‡ <span class="required">*</span></label><select id="tradeType" required><option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option><option value="Ø®Ø±ÛŒØ¯">Ø®Ø±ÛŒØ¯ (Buy)</option><option value="ÙØ±ÙˆØ´">ÙØ±ÙˆØ´ (Sell)</option></select></div>

                <!-- Ù†Ù…Ø§Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ Ø§Ø®ØªÛŒØ§Ø±ÛŒ -->
                <div class="form-group"><label>Ù†Ù…Ø§Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ</label><select id="symbol"><option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option><option value="XAU/USD">XAU/USD</option><option value="EUR/USD">EUR/USD</option><option value="BTC/USDT">BTC/USDT</option><option value="ETH/USDT">ETH/USDT</option><option value="BNB/USDT">BNB/USDT</option><option value="XRP/USDT">XRP/USDT</option><option value="SOL/USDT">SOL/USDT</option><option value="USD/JPY">USD/JPY</option><option value="GBP/USD">GBP/USD</option><option value="USD/CHF">USD/CHF</option><option value="AUD/USD">AUD/USD</option><option value="USD/CAD">USD/CAD</option></select></div>

                <div class="form-group"><label>Ù†ÙˆØ¹ Ø³ØªØ§Ù¾ <span class="required">*</span></label><select id="setupType" required><option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option><option value="Ø´Ú©Ø³Øª Ø¬Ø¹Ù„ÛŒ">Û±. Ø´Ú©Ø³Øª Ø¬Ø¹Ù„ÛŒ (Fake Breakout)</option><option value="Ù¾ÙˆÙ„Ø¨Ú©">Û². Ù¾ÙˆÙ„Ø¨Ú©</option><option value="Ø±ÛŒÙˆØ±Ø³Ø§Ù„ Ø¨Ø§Ø±">Û³. Ø±ÛŒÙˆØ±Ø³Ø§Ù„ Ø¨Ø§Ø± Ø§Ù„ Ø¨Ø±ÙˆÚ©Ø³</option></select></div>

                <!-- Multi-timeframe trend selectors -->
                <div class="form-group"><label>Ø±ÙˆÙ†Ø¯ M15 <span class="required">*</span></label><select id="trendM15" required><option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option><option value="ØµØ¹ÙˆØ¯ÛŒ">ØµØ¹ÙˆØ¯ÛŒ</option><option value="Ù†Ø²ÙˆÙ„ÛŒ">Ù†Ø²ÙˆÙ„ÛŒ</option><option value="Ø±Ù†Ø¬">Ø±Ù†Ø¬</option></select></div>
                <div class="form-group"><label>Ø±ÙˆÙ†Ø¯ M30</label><select id="trendM30"><option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option><option value="ØµØ¹ÙˆØ¯ÛŒ">ØµØ¹ÙˆØ¯ÛŒ</option><option value="Ù†Ø²ÙˆÙ„ÛŒ">Ù†Ø²ÙˆÙ„ÛŒ</option><option value="Ø±Ù†Ø¬">Ø±Ù†Ø¬</option></select></div>
                <div class="form-group"><label>Ø±ÙˆÙ†Ø¯ H1</label><select id="trendH1"><option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option><option value="ØµØ¹ÙˆØ¯ÛŒ">ØµØ¹ÙˆØ¯ÛŒ</option><option value="Ù†Ø²ÙˆÙ„ÛŒ">Ù†Ø²ÙˆÙ„ÛŒ</option><option value="Ø±Ù†Ø¬">Ø±Ù†Ø¬</option></select></div>
                <div class="form-group"><label>Ø±ÙˆÙ†Ø¯ H4</label><select id="trendH4"><option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option><option value="ØµØ¹ÙˆØ¯ÛŒ">ØµØ¹ÙˆØ¯ÛŒ</option><option value="Ù†Ø²ÙˆÙ„ÛŒ">Ù†Ø²ÙˆÙ„ÛŒ</option><option value="Ø±Ù†Ø¬">Ø±Ù†Ø¬</option></select></div>
                <div class="form-group"><label>Ø±ÙˆÙ†Ø¯ D1</label><select id="trendD1"><option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option><option value="ØµØ¹ÙˆØ¯ÛŒ">ØµØ¹ÙˆØ¯ÛŒ</option><option value="Ù†Ø²ÙˆÙ„ÛŒ">Ù†Ø²ÙˆÙ„ÛŒ</option><option value="Ø±Ù†Ø¬">Ø±Ù†Ø¬</option></select></div>
                <div class="form-group"><label>Ø±ÙˆÙ†Ø¯ MN</label><select id="trendMN"><option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option><option value="ØµØ¹ÙˆØ¯ÛŒ">ØµØ¹ÙˆØ¯ÛŒ</option><option value="Ù†Ø²ÙˆÙ„ÛŒ">Ù†Ø²ÙˆÙ„ÛŒ</option><option value="Ø±Ù†Ø¬">Ø±Ù†Ø¬</option></select></div>

                <div class="form-group"><label>Ù‚ÛŒÙ…Øª ÙˆØ±ÙˆØ¯</label><input type="number" id="entryPrice" step="0.01" placeholder="Ù…Ø«Ø§Ù„: 2050.50"></div>
                <div class="form-group"><label>Ø­Ø¯ Ø¶Ø±Ø± (SL)</label><input type="number" id="stopLoss" step="0.01" placeholder="Ù…Ø«Ø§Ù„: 2045.00"></div>
                <div class="form-group"><label>Ø­Ø¯ Ø³ÙˆØ¯ (TP)</label><input type="number" id="takeProfit" step="0.01" placeholder="Ù…Ø«Ø§Ù„: 2058.00"></div>
                <div class="form-group"><label>Ø±ÛŒØ³Ú© (Ø¯Ù„Ø§Ø±) <span class="required">*</span></label><select id="riskAmount" required><option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option><option value="5">Ûµ</option><option value="6">Û¶</option><option value="7">Û·</option><option value="8">Û¸</option><option value="9">Û¹</option><option value="10">Û±Û°</option></select></div>
                <div class="form-group"><label>Ù†Ø³Ø¨Øª Ø±ÛŒØ³Ú© Ø¨Ù‡ Ø±ÛŒÙˆØ§Ø±Ø¯ (R)</label><select id="riskReward"><option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option><option value="1">R = 1</option><option value="1.5">R = 1.5</option><option value="2">R = 2</option><option value="2.5">R = 2.5</option><option value="3">R = 3</option></select></div>
                <div class="form-group"><label>Ù†ØªÛŒØ¬Ù‡ Ù…Ø¹Ø§Ù…Ù„Ù‡ <span class="required">*</span></label><select id="tradeResult" required><option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option><option value="Ø³ÙˆØ¯">Ø³ÙˆØ¯</option><option value="Ø¶Ø±Ø±">Ø¶Ø±Ø±</option><option value="Ø³Ø±Ø¨Ù‡â€ŒØ³Ø±">Ø³Ø±Ø¨Ù‡â€ŒØ³Ø±</option><option value="Ø¨Ø§Ø²">Ø¨Ø§Ø²</option></select></div>
                <div class="form-group"><label>Ù…Ø¨Ù„Øº Ø³ÙˆØ¯/Ø¶Ø±Ø± (Ø¯Ù„Ø§Ø±)</label><input type="number" id="profitLoss" step="0.01" placeholder="Ù…Ø«Ø§Ù„: +7.5 ÛŒØ§ -5"></div>
                <div class="form-group"><label>Ø­Ø§Ù„Øª Ø°Ù‡Ù†ÛŒ Ù‚Ø¨Ù„ Ø§Ø² Ù…Ø¹Ø§Ù…Ù„Ù‡ <span class="required">*</span></label><select id="mentalState" required><option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option><option value="Ø¢Ø±Ø§Ù… Ùˆ Ù…ØªÙ…Ø±Ú©Ø²">Ø¢Ø±Ø§Ù… Ùˆ Ù…ØªÙ…Ø±Ú©Ø²</option><option value="Ø®ÙˆØ´Ø­Ø§Ù„">Ø®ÙˆØ´Ø­Ø§Ù„</option><option value="Ù†Ú¯Ø±Ø§Ù†">Ù†Ú¯Ø±Ø§Ù†</option><option value="Ø§Ø³ØªØ±Ø³">Ø§Ø³ØªØ±Ø³</option><option value="Ø¹Ø¬Ù„Ù‡">Ø¹Ø¬Ù„Ù‡</option><option value="Ø®Ø³ØªÙ‡">Ø®Ø³ØªÙ‡</option></select></div>
            </div>

            <div class="form-grid">
                <div class="form-group"><label>Ú†Ø±Ø§ ÙˆØ§Ø±Ø¯ Ø§ÛŒÙ† Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø´Ø¯Ù…ØŸ <span class="required">*</span></label><select id="reasonEntry" required>
                    <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option>
                    <option value="Ø³Ø·Ø­ Ø­Ù…Ø§ÛŒØª/Ù…Ù‚Ø§ÙˆÙ…Øª Ù‚ÙˆÛŒ + ØªØ£ÛŒÛŒØ¯ Ù¾Ø±Ø§ÛŒØ³ Ø§Ú©Ø´Ù†">Ø³Ø·Ø­ Ø­Ù…Ø§ÛŒØª/Ù…Ù‚Ø§ÙˆÙ…Øª Ù‚ÙˆÛŒ + ØªØ£ÛŒÛŒØ¯ Ù¾Ø±Ø§ÛŒØ³ Ø§Ú©Ø´Ù†</option>
                    <option value="Ø´Ú©Ø³Øª Ø¬Ø¹Ù„ÛŒ Ø¨Ø§ Ø­Ø¬Ù… Ø¨Ø§Ù„Ø§ + Ø±ÛŒÙˆØ±Ø³Ø§Ù„ Ø¨Ø§Ø±">Ø´Ú©Ø³Øª Ø¬Ø¹Ù„ÛŒ Ø¨Ø§ Ø­Ø¬Ù… Ø¨Ø§Ù„Ø§ + Ø±ÛŒÙˆØ±Ø³Ø§Ù„ Ø¨Ø§Ø±</option>
                    <option value="Ù¾ÙˆÙ„Ø¨Ú© Ø¨Ù‡ Ø³Ø·Ø­ Ø´Ú©Ø³ØªÙ‡ Ø´Ø¯Ù‡ Ø¯Ø± Ø±Ø§Ø³ØªØ§ÛŒ Ø±ÙˆÙ†Ø¯">Ù¾ÙˆÙ„Ø¨Ú© Ø¨Ù‡ Ø³Ø·Ø­ Ø´Ú©Ø³ØªÙ‡ Ø´Ø¯Ù‡ Ø¯Ø± Ø±Ø§Ø³ØªØ§ÛŒ Ø±ÙˆÙ†Ø¯</option>
                    <option value="Ø±Ø¯ Ø´Ø¯Ù† Ù‚ÙˆÛŒ Ø§Ø² Ø³Ø·Ø­ Ú©Ù„ÛŒØ¯ÛŒ Ø¨Ø§ Ø³Ø§ÛŒÙ‡ Ø¨Ù„Ù†Ø¯">Ø±Ø¯ Ø´Ø¯Ù† Ù‚ÙˆÛŒ Ø§Ø² Ø³Ø·Ø­ Ú©Ù„ÛŒØ¯ÛŒ Ø¨Ø§ Ø³Ø§ÛŒÙ‡ Ø¨Ù„Ù†Ø¯</option>
                    <option value="Ù‡Ù…Ú¯Ø±Ø§ÛŒÛŒ Ú†Ù†Ø¯ ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… (M5 + M15)">Ù‡Ù…Ú¯Ø±Ø§ÛŒÛŒ Ú†Ù†Ø¯ ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… (M5 + M15)</option>
                    <option value="Ø³ØªØ§Ù¾ Ú©ØªØ§Ø¨ÛŒ Ø§Ù„ Ø¨Ø±ÙˆÚ©Ø³ - Ø±ÛŒØ³Ú© Ø¨Ù‡ Ø±ÛŒÙˆØ§Ø±Ø¯ Ø¹Ø§Ù„ÛŒ">Ø³ØªØ§Ù¾ Ú©ØªØ§Ø¨ÛŒ Ø§Ù„ Ø¨Ø±ÙˆÚ©Ø³ - Ø±ÛŒØ³Ú© Ø¨Ù‡ Ø±ÛŒÙˆØ§Ø±Ø¯ Ø¹Ø§Ù„ÛŒ</option>
                    <option value="Ø³ÛŒÚ¯Ù†Ø§Ù„ Ù‚ÙˆÛŒ Ø¯Ø± Ø¬Ù‡Øª Ø±ÙˆÙ†Ø¯ Ø§ØµÙ„ÛŒ M15">Ø³ÛŒÚ¯Ù†Ø§Ù„ Ù‚ÙˆÛŒ Ø¯Ø± Ø¬Ù‡Øª Ø±ÙˆÙ†Ø¯ Ø§ØµÙ„ÛŒ M15</option>
                    <option value="Ù¾ÛŒÙ† Ø¨Ø§Ø± Ø¨Ø§ Ø±Ø¯ Ø´Ø¯Ù† Ø§Ø² Ù…Ù†Ø·Ù‚Ù‡ Ø§Ø±Ø²Ø´Ù…Ù†Ø¯">Ù¾ÛŒÙ† Ø¨Ø§Ø± Ø¨Ø§ Ø±Ø¯ Ø´Ø¯Ù† Ø§Ø² Ù…Ù†Ø·Ù‚Ù‡ Ø§Ø±Ø²Ø´Ù…Ù†Ø¯</option>
                    <option value="Ø´Ú©Ø³Øª Ø±Ù†Ø¬ Ø¨Ø§ Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆÙ…Ù†ØªÙˆÙ…">Ø´Ú©Ø³Øª Ø±Ù†Ø¬ Ø¨Ø§ Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆÙ…Ù†ØªÙˆÙ…</option>
                    <option value="ØªØ³Øª Ù…Ø¬Ø¯Ø¯ Ø³Ø·Ø­ + Ú©Ù†Ø¯Ù„ ØªØ£ÛŒÛŒØ¯ Ù‚ÙˆÛŒ">ØªØ³Øª Ù…Ø¬Ø¯Ø¯ Ø³Ø·Ø­ + Ú©Ù†Ø¯Ù„ ØªØ£ÛŒÛŒØ¯ Ù‚ÙˆÛŒ</option>
                    <option value="Ø¯Ùˆ Ø¨Ø§Ø± Ø±Ø¯ Ø´Ø¯Ù† Ø§Ø² ÛŒÚ© Ø³Ø·Ø­ (Double Test)">Ø¯Ùˆ Ø¨Ø§Ø± Ø±Ø¯ Ø´Ø¯Ù† Ø§Ø² ÛŒÚ© Ø³Ø·Ø­ (Double Test)</option>
                    <option value="ÙØ±ØµØª Ú©Ù…â€ŒØ±ÛŒØ³Ú© Ø¨Ø§ Ø­Ø¯ Ø¶Ø±Ø± Ú©ÙˆÚ†Ú©">ÙØ±ØµØª Ú©Ù…â€ŒØ±ÛŒØ³Ú© Ø¨Ø§ Ø­Ø¯ Ø¶Ø±Ø± Ú©ÙˆÚ†Ú©</option>
                    <option value="Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø²ÙˆØ¯Ù‡Ù†Ú¯Ø§Ù… - FOMO">âŒ Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø²ÙˆØ¯Ù‡Ù†Ø§Ù… - FOMO</option>
                    <option value="Ø¨Ø¯ÙˆÙ† ØªØ£ÛŒÛŒØ¯ Ú©Ø§ÙÛŒ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù…">âŒ Ø¨Ø¯ÙˆÙ† ØªØ£ÛŒÛŒØ¯ Ú©Ø§ÙÛŒ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù…</option>
                    <option value="Ø®Ù„Ø§Ù Ø±ÙˆÙ†Ø¯ M15 Ù…Ø¹Ø§Ù…Ù„Ù‡ Ú©Ø±Ø¯Ù…">âŒ Ø®Ù„Ø§Ù Ø±ÙˆÙ†Ø¯ M15 Ù…Ø¹Ø§Ù…Ù„Ù‡ Ú©Ø±Ø¯Ù…</option>
                </select></div>

                <div class="form-group"><label>Ø§Ø­Ø³Ø§Ø³Ø§Øª Ø¯Ø± Ø·ÙˆÙ„ Ù…Ø¹Ø§Ù…Ù„Ù‡</label><select id="emotions"><option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option><option value="Ø¢Ø±Ø§Ù… Ùˆ Ú©Ù†ØªØ±Ù„ Ú©Ø§Ù…Ù„ - Ù…Ø¹Ø§Ù…Ù„Ù‡â€ŒØ§ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ">Ø¢Ø±Ø§Ù… Ùˆ Ú©Ù†ØªØ±Ù„ Ú©Ø§Ù…Ù„ - Ù…Ø¹Ø§Ù…Ù„Ù‡â€ŒØ§ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</option><option value="Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¨Ù‡ Ù†ÙØ³ Ø¨Ø§Ù„Ø§ - Ø¨Ù‡ Ù¾Ù„Ù† Ù¾Ø§ÛŒØ¨Ù†Ø¯ Ø¨ÙˆØ¯Ù…">Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¨Ù‡ Ù†ÙØ³ Ø¨Ø§Ù„Ø§ - Ø¨Ù‡ Ù¾Ù„Ù† Ù¾Ø§ÛŒØ¨Ù†Ø¯ Ø¨ÙˆØ¯Ù…</option><option value="ØµØ¨ÙˆØ± Ùˆ Ù…Ù†ØªØ¸Ø± ØªØ£ÛŒÛŒØ¯ Ù…Ø§Ù†Ø¯Ù…">ØµØ¨ÙˆØ± Ùˆ Ù…Ù†ØªØ¸Ø± ØªØ£ÛŒÛŒØ¯ Ù…Ø§Ù†Ø¯Ù…</option><option value="Ø§Ø­Ø³Ø§Ø³ Ø®ÙˆØ¨ - Ø³ÛŒØ³ØªÙ… Ø±Ùˆ Ø¯Ù†Ø¨Ø§Ù„ Ú©Ø±Ø¯Ù…">Ø§Ø­Ø³Ø§Ø³ Ø®ÙˆØ¨ - Ø³ÛŒØ³ØªÙ… Ø±Ùˆ Ø¯Ù†Ø¨Ø§Ù„ Ú©Ø±Ø¯Ù…</option><option value="Ø¨ÛŒâ€ŒØ·Ø±Ù Ùˆ Ø¹ÛŒÙ†ÛŒ - Ù‡ÛŒØ¬Ø§Ù† Ù†Ø¯Ø§Ø´ØªÙ…">Ø¨ÛŒâ€ŒØ·Ø±Ù Ùˆ Ø¹ÛŒÙ†ÛŒ - Ù‡ÛŒØ¬Ø§Ù† Ù†Ø¯Ø§Ø´ØªÙ…</option><option value="Ù…ØªÙ…Ø±Ú©Ø² Ùˆ Ø¯Ø± Ù„Ø­Ø¸Ù‡ Ø­Ø§Ø¶Ø±">Ù…ØªÙ…Ø±Ú©Ø² Ùˆ Ø¯Ø± Ù„Ø­Ø¸Ù‡ Ø­Ø§Ø¶Ø±</option><option value="Ú©Ù…ÛŒ Ø§Ø³ØªØ±Ø³ ÙˆÙ„ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø¯Ù‡">Ú©Ù…ÛŒ Ø§Ø³ØªØ±Ø³ ÙˆÙ„ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø¯Ù‡</option><option value="Ù†Ú¯Ø±Ø§Ù†ÛŒ Ø§Ø² Ø¶Ø±Ø± Ù‚Ø¨Ù„ÛŒ">Ù†Ú¯Ø±Ø§Ù†ÛŒ Ø§Ø² Ø¶Ø±Ø± Ù‚Ø¨Ù„ÛŒ</option><option value="Ø¯Ù„Ù‡Ø±Ù‡ Ø¨Ø±Ø§ÛŒ Ø±Ø³ÛŒØ¯Ù† Ø¨Ù‡ Ø­Ø¯ Ø³ÙˆØ¯">Ø¯Ù„Ù‡Ø±Ù‡ Ø¨Ø±Ø§ÛŒ Ø±Ø³ÛŒØ¯Ù† Ø¨Ù‡ Ø­Ø¯ Ø³ÙˆØ¯</option><option value="Ú†Ù†Ø¯ Ø¨Ø§Ø± Ú†Ø§Ø±Øª Ø±Ùˆ Ú†Ú© Ú©Ø±Ø¯Ù… (Ø§Ø¶Ø·Ø±Ø§Ø¨)">Ú†Ù†Ø¯ Ø¨Ø§Ø± Ú†Ø§Ø±Øª Ø±Ùˆ Ú†Ú© Ú©Ø±Ø¯Ù… (Ø§Ø¶Ø·Ø±Ø§Ø¨)</option><option value="Ø·Ù…Ø¹ - Ø®ÙˆØ§Ø³ØªÙ… Ø¨ÛŒØ´ØªØ± Ø³ÙˆØ¯ Ú©Ù†Ù…">Ø·Ù…Ø¹ - Ø®ÙˆØ§Ø³ØªÙ… Ø¨ÛŒØ´ØªØ± Ø³ÙˆØ¯ Ú©Ù†Ù…</option></select></div>

                <div class="form-group"><label>Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª Ù…Ù†</label><select id="mistakes"><option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option><option value="Ù‡ÛŒÚ† Ø§Ø´ØªØ¨Ø§Ù‡ÛŒ - Ø·Ø¨Ù‚ Ù¾Ù„Ù† Ø¹Ù…Ù„ Ú©Ø±Ø¯Ù…">Ù‡ÛŒÚ† Ø§Ø´ØªØ¨Ø§Ù‡ÛŒ - Ø·Ø¨Ù‚ Ù¾Ù„Ù† Ø¹Ù…Ù„ Ú©Ø±Ø¯Ù…</option><option value="Ø®ÛŒÙ„ÛŒ Ø²ÙˆØ¯ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù… - Ù‚Ø¨Ù„ Ø§Ø² ØªØ£ÛŒÛŒØ¯">Ø®ÛŒÙ„ÛŒ Ø²ÙˆØ¯ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù… - Ù‚Ø¨Ù„ Ø§Ø² ØªØ£ÛŒÛŒØ¯</option><option value="Ø­Ø¯ Ø¶Ø±Ø± Ø®ÛŒÙ„ÛŒ Ú¯Ø´Ø§Ø¯ Ø¨ÙˆØ¯ (Ø¨ÛŒØ´ Ø§Ø² 10 Ø¯Ù„Ø§Ø±)">Ø­Ø¯ Ø¶Ø±Ø± Ø®ÛŒÙ„ÛŒ Ú¯Ø´Ø§Ø¯ Ø¨ÙˆØ¯ (Ø¨ÛŒØ´ Ø§Ø² 10 Ø¯Ù„Ø§Ø±)</option><option value="Ø®Ù„Ø§Ù Ø±ÙˆÙ†Ø¯ M15 Ù…Ø¹Ø§Ù…Ù„Ù‡ Ú©Ø±Ø¯Ù…">Ø®Ù„Ø§Ù Ø±ÙˆÙ†Ø¯ M15 Ù…Ø¹Ø§Ù…Ù„Ù‡ Ú©Ø±Ø¯Ù…</option><option value="Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ Ø±Ùˆ Ø¬Ø§Ø¨Ù‡â€ŒØ¬Ø§ Ú©Ø±Ø¯Ù… Ùˆ Ø¨ÛŒØ´ØªØ± Ø¶Ø±Ø± Ú©Ø±Ø¯Ù…">Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ Ø±Ùˆ Ø¬Ø§Ø¨Ù‡â€ŒØ¬Ø§ Ú©Ø±Ø¯Ù… Ùˆ Ø¨ÛŒØ´ØªØ± Ø¶Ø±Ø± Ú©Ø±Ø¯Ù…</option></select></div>

                <div class="form-group"><label>Ú†Ù‡ Ú†ÛŒØ²ÛŒ Ø¨Ø§ÛŒØ¯ Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§Ø¨Ø¯ØŸ</label><select id="improvements"><option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option><option value="Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø¯Ù‡ - Ù‡Ù…ÛŒÙ† Ù…Ø³ÛŒØ± Ø¯Ø±Ø³ØªÙ‡">Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø¯Ù‡ - Ù‡Ù…ÛŒÙ† Ù…Ø³ÛŒØ± Ø¯Ø±Ø³ØªÙ‡</option><option value="ØµØ¨ÙˆØ±ØªØ± Ø¨Ø§Ø´Ù… - Ù…Ù†ØªØ¸Ø± ØªØ£ÛŒÛŒØ¯ Ú©Ø§Ù…Ù„ Ø¨Ù…Ø§Ù†Ù…">ØµØ¨ÙˆØ±ØªØ± Ø¨Ø§Ø´Ù… - Ù…Ù†ØªØ¸Ø± ØªØ£ÛŒÛŒØ¯ Ú©Ø§Ù…Ù„ Ø¨Ù…Ø§Ù†Ù…</option><option value="Ú†Ú©â€ŒÙ„ÛŒØ³Øª Ø±Ùˆ Ø¬Ø¯ÛŒâ€ŒØªØ± Ø¨Ú¯ÛŒØ±Ù…">Ú†Ú©â€ŒÙ„ÛŒØ³Øª Ø±Ùˆ Ø¬Ø¯ÛŒâ€ŒØªØ± Ø¨Ú¯ÛŒØ±Ù…</option><option value="ÙÙ‚Ø· Ø¯Ø± Ø¬Ù‡Øª Ø±ÙˆÙ†Ø¯ M15 Ù…Ø¹Ø§Ù…Ù„Ù‡ Ú©Ù†Ù…">ÙÙ‚Ø· Ø¯Ø± Ø¬Ù‡Øª Ø±ÙˆÙ†Ø¯ M15 Ù…Ø¹Ø§Ù…Ù„Ù‡ Ú©Ù†Ù…</option></select></div>
          
                <div class="form-group">
                    <label>ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
                    <textarea id="description" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..." rows="3"></textarea>
                </div>
            </div>

            <div class="button-group">
                <button class="btn-save" onclick="saveTrade()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ù…Ø¹Ø§Ù…Ù„Ù‡</button>
                <button class="btn-update" onclick="updateTrade()">ğŸ› ï¸ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ø¹Ø§Ù…Ù„Ù‡</button>
                <button class="btn-clear" onclick="clearForm()">ğŸ”„ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…</button>
                <button class="btn-excel" onclick="exportToExcel()">ğŸ“Š Ø°Ø®ÛŒØ±Ù‡ Excel</button>
                <button class="btn-import" onclick="document.getElementById('fileInput').click()">ğŸ“¤ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Excel</button>
                <button class="btn-pdf" onclick="exportToPDF()">ğŸ“• Ø®Ø±ÙˆØ¬ÛŒ PDF</button>
            </div>
            <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls" onchange="importFromExcel(event)">
        </div>

        <div class="form-section">
            <h2 class="section-title">Ø¢Ù…Ø§Ø± Ùˆ ÙÛŒÙ„ØªØ± Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ</h2>

            <div class="filter-row">
                <label>Ø§Ø²: <input type="date" id="fromDate" class="small"></label>
                <label>ØªØ§: <input type="date" id="toDate" class="small"></label>
                <button class="small" onclick="applyFilter()">Ø§Ø¹Ù…Ø§Ù„ ÙÛŒÙ„ØªØ±</button>
                <button class="small" onclick="resetFilter()">Ù†Ù…Ø§ÛŒØ´ Ù‡Ù…Ù‡</button>
                <div id="currentFilter" style="margin-right:10px;color:#2c3e50;font-weight:700"></div>
            </div>

            <div class="stats" id="stats">
                <div class="stat-card"><h3>ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h3><p id="totalTrades">0</p></div>
                <div class="stat-card"><h3>Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø³ÙˆØ¯Ø¯Ù‡</h3><p id="winningTrades" class="profit">0</p></div>
                <div class="stat-card"><h3>Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¶Ø±Ø±Ø¯Ù‡</h3><p id="losingTrades" class="loss">0</p></div>
                <div class="stat-card"><h3>Ù†Ø±Ø® Ø¨Ø±Ø¯ (%)</h3><p id="winRate">0%</p></div>
                <div class="stat-card"><h3>Ø³ÙˆØ¯/Ø¶Ø±Ø± Ø¨Ø§Ø²Ù‡</h3><p id="totalPL">$0</p></div>
            </div>

            <h2 class="section-title">ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h2>
            <div class="journal-table">
                <table>
                    <thead>
                        <tr>
                            <th>ØªØ§Ø±ÛŒØ®</th>
                            <th>Ù†ÙˆØ¹</th>
                            <th>Ù†Ù…Ø§Ø¯</th>
                            <th>Ø³ØªØ§Ù¾</th>
                            <th>M15</th>
                            <th>M30</th>
                            <th>H1</th>
                            <th>H4</th>
                            <th>D1</th>
                            <th>MN</th>
                            <th>Ø±ÛŒØ³Ú©</th>
                            <th>R:R</th>
                            <th>Ù†ØªÛŒØ¬Ù‡</th>
                            <th>Ø³ÙˆØ¯/Ø¶Ø±Ø±</th>
                            <th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th>
                            <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="tradesTable">
                        <tr><td colspan="16" style="text-align:center;padding:40px;color:#95a5a6;">Ù‡Ù†ÙˆØ² Ù…Ø¹Ø§Ù…Ù„Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let trades = [];
        let filteredTrades = null; // null = no filter applied
        let selectedRowId = null;  // Ø±Ú©ÙˆØ±Ø¯ Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´/ÙˆÛŒØ±Ø§ÛŒØ´

        // load
        function loadTrades(){
            const saved = localStorage.getItem('xauusdTrades');
            if(saved){
                trades = JSON.parse(saved);
                updateTable();
                updateStats();
            }
        }

        function showAlert(message,type='success'){
            const alertContainer=document.getElementById('alertContainer');
            const alertDiv=document.createElement('div');
            alertDiv.className=`alert alert-${type}`;
            alertDiv.textContent=message;
            alertContainer.appendChild(alertDiv);
            setTimeout(()=>alertDiv.remove(),4000);
        }

        function readForm(){
            return {
                datetime:document.getElementById('datetime').value,
                tradeType:document.getElementById('tradeType').value,
                symbol:document.getElementById('symbol').value, // Ø§Ø®ØªÛŒØ§Ø±ÛŒ
                setupType:document.getElementById('setupType').value,
                trendM15:document.getElementById('trendM15').value,
                trendM30:document.getElementById('trendM30').value,
                trendH1:document.getElementById('trendH1').value,
                trendH4:document.getElementById('trendH4').value,
                trendD1:document.getElementById('trendD1').value,
                trendMN:document.getElementById('trendMN').value,
                entryPrice:document.getElementById('entryPrice').value,
                stopLoss:document.getElementById('stopLoss').value,
                takeProfit:document.getElementById('takeProfit').value,
                riskAmount:document.getElementById('riskAmount').value,
                riskReward:document.getElementById('riskReward').value,
                tradeResult:document.getElementById('tradeResult').value,
                profitLoss:document.getElementById('profitLoss').value,
                mentalState:document.getElementById('mentalState').value,
                reasonEntry:document.getElementById('reasonEntry').value,
                emotions:document.getElementById('emotions').value,
                mistakes:document.getElementById('mistakes').value,
                improvements:document.getElementById('improvements').value,
                description:document.getElementById('description').value
            };
        }

        function validate(trade){
            return trade.datetime && trade.tradeType && trade.setupType && trade.trendM15 && trade.riskAmount && trade.tradeResult && trade.mentalState && trade.reasonEntry;
        }

        function saveTrade(){
            const payload = readForm();
            if(!validate(payload)){
                showAlert('Ù„Ø·ÙØ§Ù‹ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø§Ø¬Ø¨Ø§Ø±ÛŒ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯','error');
                return;
            }
            const trade = { id: Date.now(), ...payload };
            trades.push(trade);
            localStorage.setItem('xauusdTrades',JSON.stringify(trades));
            selectedRowId = trade.id;
            updateTable();
            updateStats();
            showAlert('âœ… Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!','success');
            // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ø¬Ø¯ÙˆÙ„ Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø±Ú©ÙˆØ±Ø¯ Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯Ù‡
            document.getElementById('tradesTable').parentElement.scrollIntoView({ behavior:'smooth', block:'start' });
        }

        function updateTrade(){
            if(selectedRowId === null){
                showAlert('Ù‡ÛŒÚ† Ø±Ú©ÙˆØ±Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª','error');
                return;
            }
            const payload = readForm();
            if(!validate(payload)){
                showAlert('Ù„Ø·ÙØ§Ù‹ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø§Ø¬Ø¨Ø§Ø±ÛŒ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯','error');
                return;
            }
            // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø±Ú©ÙˆØ±Ø¯ Ø¯Ø± Ø¢Ø±Ø§ÛŒÙ‡ Ø§ØµÙ„ÛŒ (ÙØ§Ø±Øº Ø§Ø² ÙÛŒÙ„ØªØ±)
            const idx = trades.findIndex(t => t.id === selectedRowId);
            if(idx === -1){
                showAlert('Ø±Ú©ÙˆØ±Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ø¯Ø± Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯','error');
                return;
            }
            trades[idx] = { ...trades[idx], ...payload }; // Ø­ÙØ¸ id
            localStorage.setItem('xauusdTrades',JSON.stringify(trades));
            // Ø§Ú¯Ø± ÙÛŒÙ„ØªØ± ÙØ¹Ø§Ù„ Ø§Ø³ØªØŒ Ù…Ø¬Ø¯Ø¯ Ø§Ø¹Ù…Ø§Ù„ Ø´ÙˆØ¯ ØªØ§ Ù„ÛŒØ³Øª Ùˆ Ù‡Ø§ÛŒÙ„Ø§ÛŒØª Ø¯Ø±Ø³Øª Ø´ÙˆÙ†Ø¯
            if(filteredTrades!==null) applyFilter(); else updateTable();
            updateStats();
            showAlert('ğŸ› ï¸ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯','success');
        }

        function getActiveList(){ return filteredTrades !== null ? filteredTrades : trades; }

        function updateTable(){
            const tbody=document.getElementById('tradesTable');
            const list=getActiveList();
            if(list.length===0){
                tbody.innerHTML=`<tr><td colspan="16" style="text-align:center;padding:40px;color:#95a5a6;">Ù‡Ù†ÙˆØ² Ù…Ø¹Ø§Ù…Ù„Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</td></tr>`;
                return;
            }

            tbody.innerHTML = list.map(trade=>{
                const pl = parseFloat(trade.profitLoss) || 0;
                const plClass = pl>0?'profit':pl<0?'loss':'';
                const plSign = pl>0?'+':'';
                const isSelected = trade.id === selectedRowId ? 'selected-row' : '';
                return `
                    <tr class="${isSelected}" data-id="${trade.id}" onclick="selectTrade(${trade.id})">
                        <td>${trade.datetime? new Date(trade.datetime).toLocaleString('fa-IR') : ''}</td>
                        <td>${trade.tradeType}</td>
                        <td>${trade.symbol || '-'}</td>
                        <td>${trade.setupType}</td>
                        <td>${trade.trendM15||'-'}</td>
                        <td>${trade.trendM30||'-'}</td>
                        <td>${trade.trendH1||'-'}</td>
                        <td>${trade.trendH4||'-'}</td>
                        <td>${trade.trendD1||'-'}</td>
                        <td>${trade.trendMN||'-'}</td>
                        <td>$${trade.riskAmount}</td>
                        <td>${trade.riskReward || '-'}</td>
                        <td>${trade.tradeResult}</td>
                        <td class="${plClass}">${plSign}$${(trade.profitLoss||0)}</td>
                        <td>${trade.description ? trade.description.replace(/</g,'&lt;').replace(/>/g,'&gt;') : '-'}</td>
                        <td>
                            <button class="delete-btn" onclick="event.stopPropagation(); deleteTrade(${trade.id})">Ø­Ø°Ù</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function selectTrade(id){
            const list = getActiveList();
            const trade = list.find(t => t.id === id);
            if(!trade) return;

            selectedRowId = id;
            // Ù¾Ø± Ú©Ø±Ø¯Ù† ÙØ±Ù…
            document.getElementById('datetime').value = trade.datetime || '';
            document.getElementById('tradeType').value = trade.tradeType || '';
            document.getElementById('symbol').value = trade.symbol || '';
            document.getElementById('setupType').value = trade.setupType || '';
            document.getElementById('trendM15').value = trade.trendM15 || '';
            document.getElementById('trendM30').value = trade.trendM30 || '';
            document.getElementById('trendH1').value = trade.trendH1 || '';
            document.getElementById('trendH4').value = trade.trendH4 || '';
            document.getElementById('trendD1').value = trade.trendD1 || '';
            document.getElementById('trendMN').value = trade.trendMN || '';
            document.getElementById('entryPrice').value = trade.entryPrice || '';
            document.getElementById('stopLoss').value = trade.stopLoss || '';
            document.getElementById('takeProfit').value = trade.takeProfit || '';
            document.getElementById('riskAmount').value = trade.riskAmount || '';
            document.getElementById('riskReward').value = trade.riskReward || '';
            document.getElementById('tradeResult').value = trade.tradeResult || '';
            document.getElementById('profitLoss').value = trade.profitLoss || '';
            document.getElementById('mentalState').value = trade.mentalState || '';
            document.getElementById('reasonEntry').value = trade.reasonEntry || '';
            document.getElementById('emotions').value = trade.emotions || '';
            document.getElementById('mistakes').value = trade.mistakes || '';
            document.getElementById('improvements').value = trade.improvements || '';
            document.getElementById('description').value = trade.description || '';

            updateTable(); // Ø¨Ø±Ø§ÛŒ Ù‡Ø§ÛŒÙ„Ø§ÛŒØª Ø±Ø¯ÛŒÙ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateStats(){
            const list=getActiveList();
            const total=list.length;
            const winning=list.filter(t=>parseFloat(t.profitLoss)>0).length;
            const losing=list.filter(t=>parseFloat(t.profitLoss)<0).length;
            const winRate = total>0?((winning/total)*100).toFixed(1):0;
            const totalPL = list.reduce((s,t)=>s + (parseFloat(t.profitLoss)||0),0).toFixed(2);
            document.getElementById('totalTrades').textContent = total;
            document.getElementById('winningTrades').textContent = winning;
            document.getElementById('losingTrades').textContent = losing;
            document.getElementById('winRate').textContent = winRate + '%';
            const plEl=document.getElementById('totalPL');
            plEl.textContent = '$' + totalPL;
            plEl.className = totalPL>0?'profit':totalPL<0?'loss':'';
        }

        function deleteTrade(id){
            if(confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')){
                trades = trades.filter(t=>t.id!==id);
                if(selectedRowId === id){ // Ø§Ú¯Ø± Ø±Ú©ÙˆØ±Ø¯ Ø­Ø°Ùâ€ŒØ´Ø¯Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ø¨ÙˆØ¯ØŒ ÙØ±Ù… Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒÙ…
                    clearForm();
                }
                localStorage.setItem('xauusdTrades',JSON.stringify(trades));
                if(filteredTrades!==null) applyFilter(); else { updateTable(); updateStats(); }
                showAlert('Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø­Ø°Ù Ø´Ø¯','info');
            }
        }

        function clearForm(){
            document.querySelectorAll('input, select, textarea').forEach(el=>el.value='');
            selectedRowId = null;
            updateTable();
        }

        // Filter functions
        function applyFilter(){
            const from=document.getElementById('fromDate').value;
            const to=document.getElementById('toDate').value;
            if(!from && !to){ showAlert('Ù„Ø·ÙØ§Ù‹ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ©ÛŒ Ø§Ø² Ø¯Ùˆ ØªØ§Ø±ÛŒØ® Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯','error'); return; }
            const fromTS = from ? new Date(from + 'T00:00:00').getTime() : -Infinity;
            const toTS = to ? new Date(to + 'T23:59:59').getTime() : Infinity;
            filteredTrades = trades.filter(t=>{
                if(!t.datetime) return false;
                const ts = new Date(t.datetime).getTime();
                return ts >= fromTS && ts <= toTS;
            });
            document.getElementById('currentFilter').textContent = (from? ('Ø§Ø² '+from) : '') + (to? (' ØªØ§ '+to) : '');
            // Ø§Ú¯Ø± Ø±Ú©ÙˆØ±Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ø¯Ø± Ù„ÛŒØ³Øª ÙÛŒÙ„ØªØ± Ø´Ø¯Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ØŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ø§ Ø®Ù†Ø«ÛŒ Ú©Ù†
            if(filteredTrades && !filteredTrades.some(t => t.id === selectedRowId)) selectedRowId = null;
            updateTable();
            updateStats();
            showAlert(`âœ… ${filteredTrades.length} Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¯Ø± Ø¨Ø§Ø²Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ ÛŒØ§ÙØª Ø´Ø¯`,'success');
        }

        function resetFilter(){
            filteredTrades = null;
            document.getElementById('fromDate').value='';
            document.getElementById('toDate').value='';
            document.getElementById('currentFilter').textContent='';
            updateTable();
            updateStats();
            showAlert('Ù†Ù…Ø§ÛŒØ´ Ù‡Ù…Ù‡ Ù…Ø¹Ø§Ù…Ù„Ø§Øª','info');
        }

        // Excel export (uses current list / filtered)
        function exportToExcel(){
            const list = getActiveList();
            if(list.length===0){ showAlert('Ù‡ÛŒÚ† Ù…Ø¹Ø§Ù…Ù„Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯!','error'); return; }
            const worksheet_data = [
                ['ØªØ§Ø±ÛŒØ®','Ù†ÙˆØ¹ Ù…Ø¹Ø§Ù…Ù„Ù‡','Ù†Ù…Ø§Ø¯','Ù†ÙˆØ¹ Ø³ØªØ§Ù¾','M15','M30','H1','H4','D1','MN','Ù‚ÛŒÙ…Øª ÙˆØ±ÙˆØ¯','Ø­Ø¯ Ø¶Ø±Ø±','Ø­Ø¯ Ø³ÙˆØ¯','Ø±ÛŒØ³Ú© ($)','R:R','Ù†ØªÛŒØ¬Ù‡','Ø³ÙˆØ¯/Ø¶Ø±Ø± ($)','Ø­Ø§Ù„Øª Ø°Ù‡Ù†ÛŒ','Ø¯Ù„ÛŒÙ„ ÙˆØ±ÙˆØ¯','ØªÙˆØ¶ÛŒØ­Ø§Øª']
            ];
            list.forEach(t=>{
                worksheet_data.push([
                    t.datetime? new Date(t.datetime).toLocaleString('fa-IR') : '',
                    t.tradeType,
                    t.symbol || '',
                    t.setupType,
                    t.trendM15 || '',
                    t.trendM30 || '',
                    t.trendH1 || '',
                    t.trendH4 || '',
                    t.trendD1 || '',
                    t.trendMN || '',
                    t.entryPrice || '',
                    t.stopLoss || '',
                    t.takeProfit || '',
                    t.riskAmount,
                    t.riskReward || '',
                    t.tradeResult,
                    t.profitLoss || '0',
                    t.mentalState || '',
                    t.reasonEntry || '',
                    t.description || ''
                ]);
            });
            const ws = XLSX.utils.aoa_to_sheet(worksheet_data);
            ws['!cols'] = new Array(worksheet_data[0].length).fill({wch:18});
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Ù…Ø¹Ø§Ù…Ù„Ø§Øª');
            const fileName = `XAUUSD_Journal_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            showAlert('âœ… ÙØ§ÛŒÙ„ Excel Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!','success');
        }

        // PDF export (current list)
        async function exportToPDF(){
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({unit:'pt',format:'a4'});
            const list = getActiveList();
            if(list.length===0){ showAlert('Ù‡ÛŒÚ† Ù…Ø¹Ø§Ù…Ù„Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯!','error'); return; }
            const head = [['ØªØ§Ø±ÛŒØ®','Ù†ÙˆØ¹','Ù†Ù…Ø§Ø¯','Ø³ØªØ§Ù¾','M15','M30','H1','H4','D1','MN','Ø±ÛŒØ³Ú©','R:R','Ù†ØªÛŒØ¬Ù‡','Ø³ÙˆØ¯/Ø¶Ø±Ø±','ØªÙˆØ¶ÛŒØ­Ø§Øª']];
            const body = list.map(t => [
                t.datetime ? new Date(t.datetime).toLocaleString('fa-IR') : '',
                t.tradeType,
                t.symbol || '-',
                t.setupType,
                t.trendM15||'-',
                t.trendM30||'-',
                t.trendH1||'-',
                t.trendH4||'-',
                t.trendD1||'-',
                t.trendMN||'-',
                '$'+(t.riskAmount||''),
                t.riskReward||'-',
                t.tradeResult,
                (t.profitLoss||0),
                (t.description||'')
            ]);
            doc.setFontSize(10);
            doc.text('Ú˜ÙˆØ±Ù†Ø§Ù„ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ XAUUSD',40,40);
            doc.autoTable({
                head: head,
                body: body,
                startY: 60,
                styles:{ font:'helvetica', fontSize:9, halign:'right' },
                headStyles:{ fillColor:[102,126,234] },
                margin:{left:20,right:20}
            });
            const fileName = `XAUUSD_Journal_${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(fileName);
            showAlert('âœ… Ø®Ø±ÙˆØ¬ÛŒ PDF Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯','success');
        }

        // Import from Excel (append)
        function importFromExcel(event){
            const file = event.target.files[0]; if(!file) return;
            const reader = new FileReader();
            reader.onload = function(e){
                try{
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data,{type:'array'});
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    if(jsonData.length===0){ showAlert('ÙØ§ÛŒÙ„ Excel Ø®Ø§Ù„ÛŒ Ø§Ø³Øª!','error'); return; }
                    if(confirm(`Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ${jsonData.length} Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ØŸ (Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø­ÙØ¸ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯)`)){
                        jsonData.forEach(row=>{
                            const trade = {
                                id: Date.now()+Math.random(),
                                datetime: row['ØªØ§Ø±ÛŒØ®'] || row['Date'] || '',
                                tradeType: row['Ù†ÙˆØ¹ Ù…Ø¹Ø§Ù…Ù„Ù‡'] || row['Type'] || '',
                                symbol: row['Ù†Ù…Ø§Ø¯'] || row['Symbol'] || '',
                                setupType: row['Ù†ÙˆØ¹ Ø³ØªØ§Ù¾'] || row['Setup'] || '',
                                trendM15: row['M15'] || row['Ø±ÙˆÙ†Ø¯ M15'] || '',
                                trendM30: row['M30'] || '',
                                trendH1: row['H1'] || '',
                                trendH4: row['H4'] || '',
                                trendD1: row['D1'] || '',
                                trendMN: row['MN'] || '',
                                entryPrice: row['Ù‚ÛŒÙ…Øª ÙˆØ±ÙˆØ¯'] || '',
                                stopLoss: row['Ø­Ø¯ Ø¶Ø±Ø±'] || '',
                                takeProfit: row['Ø­Ø¯ Ø³ÙˆØ¯'] || '',
                                riskAmount: row['Ø±ÛŒØ³Ú© ($)'] || row['Risk'] || '',
                                riskReward: row['R:R'] || '',
                                tradeResult: row['Ù†ØªÛŒØ¬Ù‡'] || '',
                                profitLoss: row['Ø³ÙˆØ¯/Ø¶Ø±Ø± ($)'] || row['PL'] || '0',
                                mentalState: row['Ø­Ø§Ù„Øª Ø°Ù‡Ù†ÛŒ'] || '',
                                reasonEntry: row['Ø¯Ù„ÛŒÙ„ ÙˆØ±ÙˆØ¯'] || '',
                                description: row['ØªÙˆØ¶ÛŒØ­Ø§Øª'] || row['Description'] || ''
                            };
                            trades.push(trade);
                        });
                        localStorage.setItem('xauusdTrades',JSON.stringify(trades));
                        // Ø­ÙØ¸ ÛŒØ§ Ø±ÛŒØ³Øª Ø§Ù†ØªØ®Ø§Ø¨
                        if(filteredTrades!==null) applyFilter(); else { updateTable(); updateStats(); }
                        showAlert(`âœ… ${jsonData.length} Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯!`,'success');
                    }
                }catch(err){
                    console.error(err);
                    showAlert('Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„ Excel!','error');
                }
            };
            reader.readAsArrayBuffer(file);
            event.target.value='';
        }

        // Initialize
        loadTrades();
    </script>
</body>
</html>
